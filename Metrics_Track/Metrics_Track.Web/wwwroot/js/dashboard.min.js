function expandCollapseAria(e,a,t){if(a){if("#country"===t){$("input[name=CountrySelection]").val("");var n="#process-"+$("input[name=ProcessSelection]").val();e.parent().next().find(".btn-group-vertical label").each(function(e,a){a.classList.remove("active")}),$(n).attr("aria-expanded",!1),$(n).prev().children().attr("aria-expanded",!1),$(n).removeClass("in")}$("input[name=ProcessSelection]").val(""),$("input[name=ProcessName]").val(""),$("input[name=ActivitySelection]").val(""),$("input[name=ActivityName]").val(""),$("input[name=LobSelection]").val(""),$("input[name=LobName]").val(""),$("input[name=StatusSelection]").val(""),$("input[name=StatusName]").val("")}else{e.parent().next().find(".btn-group-vertical label").each(function(e,a){a.classList.remove("active")}),$("input[name=ActivitySelection]").val(""),$("input[name=ActivityName]").val(""),$("input[name=LobSelection]").val(""),$("input[name=LobName]").val(""),$("input[name=StatusSelection]").val(""),$("input[name=StatusName]").val("");var i=e.data("id"),r=e.text().trim();"#country"===t?$("#Transaction_IdCountry").val(i):($("#Transaction_IdProcess").val(i),$("input[name=ProcessName]").val(r))}}function returnTransaction(e){return $.ajax({type:"Get",url:"/dashboard/returntransaction",dataType:"json",contentType:"application/json; charset=utf-8",data:{transactionId:e},success:function(a){a.success?(closeOpened(a.transaction.idCountry),openClosed(a.transaction.idCountry,a.transaction.idProcess),populateData(a.transaction),$("#previous-"+e).remove(),$("#pending-"+e).remove()):alert(a.errors)},error:function(e){alert("Internal error. Please contact support.")}}),!1}function populateData(e){$("#Transaction_IdCountry").val(e.idCountry),$("#Transaction_IdProcess").val(e.idProcess),$("input[name=ProcessName]").val(e.process),$("#Transaction_IdActivity").val(e.idActivity),$("input[name=ActivityName]").val(e.activity),$("#Transaction_IdLob").val(e.idLob),$("input[name=LobName]").val(e.lob),$("#Transaction_IdStatus").val(e.idStatus),$("input[name=StatusName]").val(e.status),$("#Transaction_ReceivedDate").val(moment(new Date(e.receivedDate)).format("YYYY-MM-DD HH:mm:ss")),$("#comment1").val(e.comment),$("#policynumber1").val(e.idNumber),$("#amount1").val(e.premium),$("#currCode1").val(e.currencyCode),1===e.priority?$("#priorityCheck").prop("checked",!0):$("#priorityCheck").prop("checked",!1),null!==e.inceptionDate?$("#Transaction_InceptionDate").val(moment(new Date(e.inceptionDate)).format("YYYY-MM-DD HH:mm:ss")):$("#Transaction_InceptionDate").val(""),null!==e.dateReceivedInAig?$("#Transaction_DateReceivedInAig").val(moment(new Date(e.dateReceivedInAig)).format("YYYY-MM-DD HH:mm:ss")):$("#Transaction_DateReceivedInAig").val("");var a="#process-"+e.idProcess;$(a).find("#Lob").children().find("input").filter("#"+e.idLob).parent().addClass("active"),$(a).find("#Activity").children().find("input").filter("#"+e.idActivity).parent().addClass("active"),$(a).find("#Status").children().find("input").filter("#"+e.idStatus).parent().addClass("active")}function closeOpened(e){var a="#process-"+$("input[name=ProcessSelection]").val();expandCollapseAria($(a),!0,""),$(a).attr("aria-expanded",!1),$(a).prev().children().attr("aria-expanded",!1),$(a).removeClass("in");var t=$("input[name=CountrySelection]").val();if(parseInt(t)!==e&&""!==t){var n="#country-"+t;$(n).attr("aria-expanded",!1),$(n).prev().children().attr("aria-expanded",!1),$(n).removeClass("in"),$("#Transaction_IdCountry").val("")}}function openClosed(e,a){if(""===$("input[name=CountrySelection]").val()){var t="#country-"+e;$(t).attr("aria-expanded",!0),$(t).prev().children().attr("aria-expanded",!0),$(t).addClass("in")}var n="#process-"+a;$(n).attr("aria-expanded",!0),$(n).prev().children().attr("aria-expanded",!0),$(n).addClass("in")}function resetForm(e,a,t,n,i){var r=!0===t?"#sectionCheck":"",o=!0===n?"#receivedCheck":"",s=!0===i?"#priorityCheck":"",c=!0===n?"#Transaction_ReceivedDate":"";!0===t||(e.find("input:text, input:password, input:file, select, textarea").not(c).not("#Transaction_StartDate").not("#Transaction_IdCountry").val(""),expandCollapseAria($(a),!0,""),$(a).attr("aria-expanded",!1),$(a).prev().children().attr("aria-expanded",!1),$(a).removeClass("in")),e.find("input:radio, input:checkbox").filter(r|o|s).prop("checked",!0)}$(function(){$(".btn-default").on("click",function(){var e=$(this).find("input").attr("id"),a=$(this).text().trim();switch($(this).parent().attr("id")){case"Lob":$("input[name=LobSelection]").val(e),$("input[name=LobName]").val(a);break;case"Activity":$("input[name=ActivitySelection]").val(e),$("input[name=ActivityName]").val(a);break;case"Status":$("input[name=StatusSelection]").val(e),$("input[name=StatusName]").val(a)}}),$(".list-group-item").on("click",function(){var e=$(this).data("parent"),a="true"===$(this).attr("aria-expanded");expandCollapseAria($(this),a,e)}),$("#useractivity").on("change",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=$('input[name="__RequestVerificationToken"]',$("#submittranform")).val(),t={Type:$(this).val(),Comment:$("#comment1").val()};return $.ajax({type:"POST",dataType:"json",url:"/dashboard/UpdateStatus",data:{__RequestVerificationToken:a,model:t},success:function(e){document.getElementById("currentstatus").innerHTML=e.status},error:function(e){alert("Internal error. Please contact support.")}}),!1}),$("#submittranform").on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).find("[data-valmsg-replace]").removeClass("field-validation-error").addClass("field-validation-valid").empty(),$(this).data("validator").settings.ignore="";var a=$('input[name="__RequestVerificationToken"]',$(this)).val(),t={IdCountry:$("input[name=CountrySelection]").val(),IdProcess:$("input[name=ProcessSelection]").val(),IdActivity:$("input[name=ActivitySelection]").val(),IdLob:$("input[name=LobSelection]").val(),IdDivision:$("input[name=ProcessSelection]").val(),IdTowerCategory:$("input[name=ProcessSelection]").val(),IdTower:$("input[name=ProcessSelection]").val(),ReceivedDate:moment($("#Transaction_ReceivedDate").val()).isValid()?moment($("#Transaction_ReceivedDate").val()).format("YYYY-MM-DD HH:mm:ss"):null,StartDate:null,IdStatus:$("input[name=StatusSelection]").val(),Comment:$("#comment1").val(),IdNumber:$("#policynumber1").val(),Premium:$("#amount1").val(),CurrencyCode:$("#currCode1").val(),IsPriority:$("#priorityCheck").prop("checked"),InceptionDate:moment($("#Transaction_InceptionDate").val()).isValid()?moment($("#Transaction_InceptionDate").val()).format("YYYY-MM-DD HH:mm:ss"):null,DateReceivedInAig:moment($("#Transaction_DateReceivedInAig").val()).isValid()?moment($("#Transaction_DateReceivedInAig").val()).format("YYYY-MM-DD HH:mm:ss"):null};if($(this).valid())$.ajax({type:"POST",dataType:"json",url:"/dashboard/SubmitTransaction",data:{__RequestVerificationToken:a,model:t},success:function(e){if(e.success){var a=$("input[name=ProcessName]").val(),t="#process-"+$("input[name=ProcessSelection]").val(),n=$("input[name=LobName]").val(),i=null===e.prem?"":e.prem,r=moment($("#Transaction_ReceivedDate").val()).format("YYYY-MM-DD HH:mm:ss"),o=e.newId,s=$("input[name=StatusName]").val(),c=$("#previousTransactionTable");$("#previousTransactionTable > tbody").html("");var l="<tr id=previous-"+o+"><td>"+a+"</td><td>"+n+"</td><td>"+i+"</td><td>"+r+'</td><td><button type="button" class="btn btn-info btn-xs" onclick="returnTransaction('+o+')">'+o+"</button></td><td>"+s+"</td></tr>";if(c.append(l),e.pending){var d=$("#pendingTransactionTable"),p=l.replace("<tr id=previous-"+o+">","<tr id=pending-"+o+">");d.append(p)}$("#previousProcessId").val($("input[name=ProcessSelection]").val()),$("#previousLobId").val($("input[name=LobSelection]").val()),$("#previousPremium").val(i),$("#previousReceivedDate").val(r),$("#previousDocId").val(o),$("#previousStatusId").val($("input[name=StatusSelection]").val());var u=$("#sectionCheck").prop("checked"),v=$("#receivedCheck").prop("checked"),m=$("#priorityCheck").prop("checked");resetForm($("#submittranform"),t,u,v,m),$("#Transaction_StartDate").val(moment(new Date(e.startDate)).format("YYYY-MM-DD HH:mm:ss"))}else $.each(e.errors,function(e,a){alert(a)})},error:function(e){alert("Internal error. Please contact support.")}});else{var n=$(this).validate();$.each(n.errorList,function(e,a){$errorSpan=$("span[data-valmsg-for='"+a.element.id.replace("_",".")+"']"),$errorSpan.html("<span style='color:red'>"+a.message+"</span>")})}})});